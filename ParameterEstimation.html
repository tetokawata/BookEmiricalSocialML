<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>R/Pythonによる比較・因果推論・予測研究 (ver 0.1) - 2&nbsp; 線形モデルによるパラメータの推定</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Prediction.html" rel="next">
<link href="./intro.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">線形モデルによるパラメータの推定</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R/Pythonによる比較・因果推論・予測研究 (ver 0.1)</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">準備</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ParameterEstimation.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">線形モデルによるパラメータの推定</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Prediction.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">予測</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CausalMachineLearning.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">セミパラメトリック推定</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">付録: 記述統計</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./PreProcess.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">付録: データ整備</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#設定" id="toc-設定" class="nav-link active" data-scroll-target="#設定"><span class="toc-section-number">2.1</span>  設定</a></li>
  <li><a href="#sec-ParameterEstimation" id="toc-sec-ParameterEstimation" class="nav-link" data-scroll-target="#sec-ParameterEstimation"><span class="toc-section-number">2.2</span>  パラメータの推定</a>
  <ul class="collapse">
  <li><a href="#rctデータへの応用" id="toc-rctデータへの応用" class="nav-link" data-scroll-target="#rctデータへの応用"><span class="toc-section-number">2.2.1</span>  RCTデータへの応用</a></li>
  </ul></li>
  <li><a href="#sec-Matching" id="toc-sec-Matching" class="nav-link" data-scroll-target="#sec-Matching"><span class="toc-section-number">2.3</span>  マッチング法による修正</a>
  <ul class="collapse">
  <li><a href="#coarsened-exact-matching" id="toc-coarsened-exact-matching" class="nav-link" data-scroll-target="#coarsened-exact-matching"><span class="toc-section-number">2.3.1</span>  Coarsened exact matching</a></li>
  <li><a href="#propensity-score-with-subclassification" id="toc-propensity-score-with-subclassification" class="nav-link" data-scroll-target="#propensity-score-with-subclassification"><span class="toc-section-number">2.3.2</span>  Propensity score with subclassification</a></li>
  </ul></li>
  <li><a href="#sec-Appendix" id="toc-sec-Appendix" class="nav-link" data-scroll-target="#sec-Appendix"><span class="toc-section-number">2.4</span>  付録：推定結果の保存と表示</a>
  <ul class="collapse">
  <li><a href="#dot-and-whisker-plotによる可視化" id="toc-dot-and-whisker-plotによる可視化" class="nav-link" data-scroll-target="#dot-and-whisker-plotによる可視化"><span class="toc-section-number">2.4.1</span>  Dot-and-Whisker plotによる可視化</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-ParameterLinearEstimation" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">線形モデルによるパラメータの推定</span></span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<ul>
<li><p>関心のあるパラメータ<span class="math inline">\(\tau(X)=E[Y|d,X]-E[Y|d',X]\)</span>を埋め込んだ線形モデルを推定する。</p>
<ul>
<li>典型的には、<span class="math inline">\(E[Y|D,X]\)</span>を線形近似し、推定する。</li>
</ul></li>
</ul>
<p><span class="math display">\[E[Y|D=d,X=x]=\underbrace{\tau}_{Interest\ parameter}\times d+\underbrace{f(x)}_{Nuisance\ function}\]</span> - <span class="math inline">\(f(X)=\beta_0 + \beta_1 X_1 + ...+\beta_LX_L\)</span></p>
<ul>
<li><p><span class="math inline">\(\tau\)</span>について点推定だけでなく、信頼区間も推定する。</p>
<ul>
<li><p><a href="#sec-ParameterEstimation">Section&nbsp;<span>2.2</span></a> 線形モデルを推定し、信頼区間を計算する方法を紹介</p></li>
<li><p><a href="#sec-Matching">Section&nbsp;<span>2.3</span></a> 近似モデルの定式化への依存度を下げるために、マッチング法を用いた前処理を導入</p></li>
<li><p><a href="#sec-Appendix">Section&nbsp;<span>2.4</span></a>推定結果の表によるまとめ、可視化、および複数の推定結果を効率的に保存する方法を紹介</p></li>
</ul></li>
</ul>
<section id="設定" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="設定"><span class="header-section-number">2.1</span> 設定</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AER)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(estimatr) <span class="co"># Estimation with robust standard error</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MatchIt) <span class="co"># Matching for preprocess</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>Data_R <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"ExampleData/Example.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p><a href="https://declaredesign.org/r/estimatr/">estimatr</a></p></li>
<li><p><a href="https://kosukeimai.github.io/MatchIt/">MatchIt</a></p></li>
</ul>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>Data_Python <span class="op">=</span> pd.read_csv(<span class="st">'ExampleData/Example.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="sec-ParameterEstimation" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="sec-ParameterEstimation"><span class="header-section-number">2.2</span> パラメータの推定</h2>
<ul>
<li><p><span class="math inline">\(\tau(x)=\tau,f(x)=\beta_0+\beta_1x_1+...+\beta_Lx_L\)</span>と特定化</p></li>
<li><p>サンプル内MSEを最大化するように推定</p></li>
<li><p>線形モデルによる推定は、いくつかの問題がある</p>
<ul>
<li><p>異なるグループ間で、<span class="math inline">\(X\)</span>の分布が異なる場合、回帰式の定式化に強く依存する</p></li>
<li><p>一般に平均効果ではなく、加重平均が推計される</p></li>
<li><p>サンプルサイズに比べて、少数のコントロール変数を導入できない</p></li>
</ul></li>
<li><p>以下ではマッチング法、機械学手法を用いた頑強な推定を目指す</p></li>
</ul>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<ul>
<li><p>robust standard errorを計算するためにestimatrパッケージを利用</p></li>
<li><p>lm_robust関数で推定</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm_robust</span>(Price <span class="sc">~</span> Reform <span class="sc">+</span> TradeQ <span class="sc">+</span> Size <span class="sc">+</span> BuildYear <span class="sc">+</span> Distance, <span class="co"># Outcome ~ Treatment + Controls</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> Data_R)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Estimate  Std. Error    t value      Pr(&gt;|t|)      CI Lower
(Intercept) -1388.4988461 26.32698942 -52.740510  0.000000e+00 -1440.1030211
Reform          3.8725217  0.43467146   8.909078  5.737306e-19     3.0205116
TradeQ          0.6242352  0.19779659   3.155945  1.602999e-03     0.2365293
Size            0.8355270  0.01284035  65.070430  0.000000e+00     0.8103583
BuildYear       0.6981813  0.01307451  53.400209  0.000000e+00     0.6725537
Distance       -1.4171745  0.04437330 -31.937548 1.679446e-216    -1.5041516
                 CI Upper    DF
(Intercept) -1336.8946710 14787
Reform          4.7245319 14787
TradeQ          1.0119411 14787
Size            0.8606957 14787
BuildYear       0.7238090 14787
Distance       -1.3301973 14787</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<ul>
<li><p>statsmodelsパッケージを利用</p></li>
<li><p>heteroscedasticity robust (HC3)を設定</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> smf.ols(<span class="st">'Price ~ Reform + TradeQ + Size + BuildYear + Distance'</span>, data<span class="op">=</span>Data_Python).fit(cov_type<span class="op">=</span><span class="st">'HC3'</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                  Price   R-squared:                       0.425
Model:                            OLS   Adj. R-squared:                  0.425
Method:                 Least Squares   F-statistic:                     1197.
Date:                Mon, 31 Oct 2022   Prob (F-statistic):               0.00
Time:                        20:29:18   Log-Likelihood:                -67666.
No. Observations:               14793   AIC:                         1.353e+05
Df Residuals:                   14787   BIC:                         1.354e+05
Df Model:                           5                                         
Covariance Type:                  HC3                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept  -1388.4988     26.334    -52.726      0.000   -1440.113   -1336.885
Reform         3.8725      0.435      8.906      0.000       3.020       4.725
TradeQ         0.6242      0.198      3.155      0.002       0.236       1.012
Size           0.8355      0.013     65.048      0.000       0.810       0.861
BuildYear      0.6982      0.013     53.385      0.000       0.673       0.724
Distance      -1.4172      0.044    -31.928      0.000      -1.504      -1.330
==============================================================================
Omnibus:                    33924.864   Durbin-Watson:                   1.199
Prob(Omnibus):                  0.000   Jarque-Bera (JB):       1076517538.013
Skew:                          21.520   Prob(JB):                         0.00
Kurtosis:                    1323.863   Cond. No.                     3.28e+05
==============================================================================

Notes:
[1] Standard Errors are heteroscedasticity robust (HC3)
[2] The condition number is large, 3.28e+05. This might indicate that there are
strong multicollinearity or other numerical problems.</code></pre>
</div>
</div>
</div>
</div>
</div>
<section id="rctデータへの応用" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="rctデータへの応用"><span class="header-section-number">2.2.1</span> RCTデータへの応用</h3>
<ul>
<li><p>原因変数が完全にランダム化されている場合、因果効果の<strong>識別</strong>を目的に回帰分析を応用する必要はない</p></li>
<li><p>因果効果の<strong>推定</strong>の改善、効率性向上、を目的とした線形モデルの利用は議論されてきた</p></li>
<li><p><span class="citation" data-cites="lin2013">Lin (<a href="references.html#ref-lin2013" role="doc-biblioref">2013</a>)</span> は、以下のような交差項を導入したモデルを用いることで、平均の差の推定に比べて、漸近的効率性が悪化することはない（同等か改善する）ことを示した</p></li>
</ul>
<p><span class="math display">\[E[Y|D,X]=\beta_{D}\times D+\beta_1\times X_1+...+\beta_L\times X_L\]</span></p>
<p><span class="math display">\[+\underbrace{\beta_{1D}\times D\times X_1+...+\beta_{LD}\times D\times X_L}_{交差項}\]</span></p>
<ul>
<li>lm_lin関数で推定可能</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm_lin</span>(Price <span class="sc">~</span> Reform, <span class="co"># Outcome ~ Treatment</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>       <span class="sc">~</span> TradeQ <span class="sc">+</span> Size <span class="sc">+</span> BuildYear <span class="sc">+</span> Distance, <span class="co"># ~ Controls</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">data =</span> Data_R)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       Estimate Std. Error     t value      Pr(&gt;|t|)
(Intercept)        38.574938756 0.23419642 164.7119043  0.000000e+00
Reform              3.198398709 0.46416205   6.8906941  5.776551e-12
TradeQ_c            0.589548934 0.24839614   2.3734223  1.763681e-02
Size_c              0.836196335 0.01462551  57.1738400  0.000000e+00
BuildYear_c         0.742123631 0.01496681  49.5846277  0.000000e+00
Distance_c         -1.393206627 0.05322394 -26.1763134 1.120269e-147
Reform:TradeQ_c     0.172655995 0.37815512   0.4565745  6.479836e-01
Reform:Size_c      -0.004222054 0.03058905  -0.1380250  8.902225e-01
Reform:BuildYear_c -0.154969457 0.03044214  -5.0906230  3.612720e-07
Reform:Distance_c  -0.086574362 0.09590703  -0.9026905  3.667049e-01
                      CI Lower    CI Upper    DF
(Intercept)        38.11588462 39.03399290 14783
Reform              2.28858332  4.10821410 14783
TradeQ_c            0.10266158  1.07643629 14783
Size_c              0.80752852  0.86486415 14783
BuildYear_c         0.71278682  0.77146044 14783
Distance_c         -1.49753218 -1.28888107 14783
Reform:TradeQ_c    -0.56857511  0.91388710 14783
Reform:Size_c      -0.06418041  0.05573630 14783
Reform:BuildYear_c -0.21463984 -0.09529907 14783
Reform:Distance_c  -0.27456407  0.10141535 14783</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-Matching" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="sec-Matching"><span class="header-section-number">2.3</span> マッチング法による修正</h2>
<ul>
<li><p>回帰を行う事前準備としてマッチング法を利用する</p>
<ul>
<li><p>重回帰が持つ関数形への依存度を減らせる <span class="citation" data-cites="ho2007">(<a href="references.html#ref-ho2007" role="doc-biblioref">Ho et al. 2007</a>)</span></p></li>
<li><p>MathItパッケージを利用</p></li>
</ul></li>
<li><p>多数のマッチング法が実装されている</p></li>
</ul>
<section id="coarsened-exact-matching" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="coarsened-exact-matching"><span class="header-section-number">2.3.1</span> Coarsened exact matching</h3>
<ul>
<li><p>Coarsened exact matching <span class="citation" data-cites="iacus2012">(<a href="references.html#ref-iacus2012" role="doc-biblioref">Iacus, King, and Porro 2012</a>)</span>の実装</p>
<ul>
<li>連続変数をカテゴリー変数化することで、マッチングできるサンプルサイズを増やすことが期待できる</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fit.m <span class="ot">&lt;-</span> <span class="fu">matchit</span>(Reform <span class="sc">~</span> TradeQ <span class="sc">+</span> Size <span class="sc">+</span> BuildYear <span class="sc">+</span> Distance,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> Data_R,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> <span class="st">"CEM"</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                 )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>マッチング結果の表示</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fit.m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A matchit object
 - method: Coarsened exact matching
 - number of obs.: 14793 (original), 9625 (matched)
 - target estimand: ATT
 - covariates: TradeQ, Size, BuildYear, Distance</code></pre>
</div>
</div>
<ul>
<li><p>Sample sizesにて、マッチングできなかったサンプル数（14793の事例中、9625サンプルがマッチングできなかった）が確認できる</p></li>
<li><p>マッチング結果の図示</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fit.m <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">abs =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ParameterEstimation_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>マッチング結果を変数として含んだデータを作成</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">match.data</span>(fit.m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>“subclass”: マッチングしたグループ</p></li>
<li><p>“weights”：マッチング後の推計に用いるウェイト</p></li>
<li><p>マッチングしたデータを用いた推定</p>
<ul>
<li>新たに作成されるweight (defaltではweights)を用いた、加重推定で実装</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm_robust</span>(Price <span class="sc">~</span> Reform <span class="sc">+</span> TradeQ <span class="sc">+</span> Size <span class="sc">+</span> BuildYear <span class="sc">+</span> Distance,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>          df,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">weights =</span> weights,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">clusters =</span> subclass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Estimate  Std. Error    t value      Pr(&gt;|t|)      CI Lower
(Intercept) -1311.7224181 49.24745093 -26.635336  1.958605e-69 -1408.8022390
Reform          4.7327819  0.45785352  10.336891  2.940391e-23     3.8336958
TradeQ          0.4481538  0.28287157   1.584301  1.144379e-01    -0.1090656
Size            0.7219818  0.01918252  37.637485 2.430409e-113     0.6842264
BuildYear       0.6615543  0.02458901  26.904467  1.016361e-70     0.6130877
Distance       -1.3201228  0.07892931 -16.725382  2.395637e-43    -1.4755318
                 CI Upper       DF
(Intercept) -1214.6425972 211.0880
Reform          5.6318679 636.5110
TradeQ          1.0053732 240.7352
Size            0.7597372 288.6097
BuildYear       0.7100210 214.7855
Distance       -1.1647137 264.7544</code></pre>
</div>
</div>
</section>
<section id="propensity-score-with-subclassification" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="propensity-score-with-subclassification"><span class="header-section-number">2.3.2</span> Propensity score with subclassification</h3>
<ul>
<li><p>Coarsened exact matchingでもマッチングできないサンプルが多数出てくる可能性</p>
<ul>
<li>とくに<span class="math inline">\(X\)</span>が大量にある場合</li>
</ul></li>
<li><p>1次元の距離指標を用いて、マッチングを行う</p>
<ul>
<li>距離指標としては、Mahalanobis’ Distance、Propensity scoreなど</li>
</ul></li>
<li><p>ここではPropensity score <span class="math inline">\(p_d(X)\)</span>を用いる</p></li>
</ul>
<p><span class="math display">\[p_d(X)\equiv \Pr[D=d|X]\]</span></p>
<ul>
<li><p>属性<span class="math inline">\(X\)</span>のユニットの中で、原因変数の値が<span class="math inline">\(d\)</span>である人の割合</p></li>
<li><p>未知の場合、データから推定する必要がある</p></li>
<li><p>推定された傾向スコアを用いたStratification マッチング <span class="citation" data-cites="imbens2015">(<a href="references.html#ref-imbens2015" role="doc-biblioref">Imbens 2015</a> の推奨)</span></p>
<p>-　ロジットにて傾向スコアを推定</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fit.m <span class="ot">&lt;-</span> <span class="fu">matchit</span>(Reform <span class="sc">~</span> TradeQ <span class="sc">+</span> Size <span class="sc">+</span> BuildYear <span class="sc">+</span> Distance,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> Data_R,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> <span class="st">"subclass"</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">estimand =</span> <span class="st">"ATE"</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                 )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>マッチング結果</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
matchit(formula = Reform ~ TradeQ + Size + BuildYear + Distance, 
    data = Data_R, method = "subclass", estimand = "ATE")

Summary of Balance for All Data:
          Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean
distance         0.3418        0.2260          0.7825     1.4151    0.2293
TradeQ           2.4827        2.4422          0.0363     1.0239    0.0101
Size            49.8096       45.1755          0.2152     0.7953    0.0438
BuildYear     1993.5456     2003.2632         -0.7800     1.1529    0.1649
Distance         7.2755        6.9736          0.0740     1.0298    0.0149
          eCDF Max
distance    0.3455
TradeQ      0.0184
Size        0.1621
BuildYear   0.3415
Distance    0.0337

Summary of Balance Across Subclasses
          Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean
distance         0.2576        0.2545          0.0212     1.0285    0.0062
TradeQ           2.4606        2.4535          0.0063     1.0386    0.0060
Size            45.5250       46.3742         -0.0394     0.8215    0.0172
BuildYear     2000.4362     2000.8722         -0.0350     0.9634    0.0093
Distance         6.9579        7.0579         -0.0245     0.9047    0.0061
          eCDF Max
distance    0.0160
TradeQ      0.0145
Size        0.0600
BuildYear   0.0353
Distance    0.0151

Sample Sizes:
               Control Treated
All           11012.   3781.  
Matched (ESS) 10508.41 2553.82
Matched       11012.   3781.  
Unmatched         0.      0.  
Discarded         0.      0.  </code></pre>
</div>
</div>
<ul>
<li>マッチング結果の図示</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>fit.m <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">abs =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ParameterEstimation_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>マッチングしたデータを用いた推定</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm_robust</span>(Price <span class="sc">~</span> Reform <span class="sc">+</span> TradeQ <span class="sc">+</span> Size <span class="sc">+</span> BuildYear <span class="sc">+</span> Distance,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>          df,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">weights =</span> weights,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">clusters =</span> subclass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Estimate  Std. Error    t value      Pr(&gt;|t|)      CI Lower
(Intercept) -1311.7224181 49.24745093 -26.635336  1.958605e-69 -1408.8022390
Reform          4.7327819  0.45785352  10.336891  2.940391e-23     3.8336958
TradeQ          0.4481538  0.28287157   1.584301  1.144379e-01    -0.1090656
Size            0.7219818  0.01918252  37.637485 2.430409e-113     0.6842264
BuildYear       0.6615543  0.02458901  26.904467  1.016361e-70     0.6130877
Distance       -1.3201228  0.07892931 -16.725382  2.395637e-43    -1.4755318
                 CI Upper       DF
(Intercept) -1214.6425972 211.0880
Reform          5.6318679 636.5110
TradeQ          1.0053732 240.7352
Size            0.7597372 288.6097
BuildYear       0.7100210 214.7855
Distance       -1.1647137 264.7544</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-Appendix" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="sec-Appendix"><span class="header-section-number">2.4</span> 付録：推定結果の保存と表示</h2>
<section id="dot-and-whisker-plotによる可視化" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="dot-and-whisker-plotによる可視化"><span class="header-section-number">2.4.1</span> Dot-and-Whisker plotによる可視化</h3>
<ul>
<li>Dot-and-Whisker図により点推定量と信頼区間を可視化</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fit.m <span class="ot">&lt;-</span> <span class="fu">matchit</span>(Reform <span class="sc">~</span> TradeQ <span class="sc">+</span> Size <span class="sc">+</span> BuildYear <span class="sc">+</span> Distance,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> Data_R,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> <span class="st">"CEM"</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">match.data</span>(fit.m)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>Result1 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(Price <span class="sc">~</span> Reform <span class="sc">+</span> TradeQ <span class="sc">+</span> Size <span class="sc">+</span> BuildYear <span class="sc">+</span> Distance,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> df) <span class="sc">|&gt;</span> </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"Reform"</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">|&gt;</span> </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Method =</span> <span class="st">"OLS"</span>)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>Result1 <span class="sc">|&gt;</span> </span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> term,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> estimate,</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> conf.low,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> conf.high)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>() <span class="sc">+</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ParameterEstimation_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>Result2 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(Price <span class="sc">~</span> Reform <span class="sc">+</span> TradeQ <span class="sc">+</span> Size <span class="sc">+</span> BuildYear <span class="sc">+</span> Distance,</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> df,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">weights =</span> weights,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">clusters =</span> subclass) <span class="sc">|&gt;</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"Reform"</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">|&gt;</span> </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Method =</span> <span class="st">"Matching + OLS"</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>Result1 <span class="sc">|&gt;</span> </span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(Result2) <span class="sc">|&gt;</span> </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Method,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> estimate,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> conf.low,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> conf.high)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>() <span class="sc">+</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ParameterEstimation_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-ho2007" class="csl-entry" role="doc-biblioentry">
Ho, Daniel E., Kosuke Imai, Gary King, and Elizabeth A. Stuart. 2007. <span>“Matching as Nonparametric Preprocessing for Reducing Model Dependence in Parametric Causal Inference.”</span> <em>Political Analysis</em> 15 (3): 199–236. <a href="https://doi.org/10.1093/pan/mpl013">https://doi.org/10.1093/pan/mpl013</a>.
</div>
<div id="ref-iacus2012" class="csl-entry" role="doc-biblioentry">
Iacus, Stefano M., Gary King, and Giuseppe Porro. 2012. <span>“Causal Inference Without Balance Checking: Coarsened Exact Matching.”</span> <em>Political Analysis</em> 20 (1): 1–24. <a href="https://doi.org/10.1093/pan/mpr013">https://doi.org/10.1093/pan/mpr013</a>.
</div>
<div id="ref-imbens2015" class="csl-entry" role="doc-biblioentry">
Imbens, Guido W. 2015. <span>“Matching Methods in Practice: Three Examples.”</span> <em>The Journal of Human Resources</em> 50 (2): 373–419. <a href="https://www.jstor.org/stable/24735990">https://www.jstor.org/stable/24735990</a>.
</div>
<div id="ref-lin2013" class="csl-entry" role="doc-biblioentry">
Lin, Winston. 2013. <span>“Agnostic Notes on Regression Adjustments to Experimental Data: Reexamining Freedman<span>’</span>s Critique.”</span> <em>The Annals of Applied Statistics</em> 7 (1): 295–318. <a href="https://doi.org/10.1214/12-AOAS583">https://doi.org/10.1214/12-AOAS583</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./intro.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">準備</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Prediction.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">予測</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>